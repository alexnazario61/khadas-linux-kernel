From 0bde7f8ed0ece5c4747ef97b8f8833343f2bb94b Mon Sep 17 00:00:00 2001
From: hyphop <email2tema@gmail.com>
Date: Tue, 3 Sep 2019 01:45:08 +0300
Subject: [PATCH] dts_patch

---
 arch/arm64/boot/dts/amlogic/meson-g12-common.dtsi  | 36 ++++++++--------
 .../boot/dts/amlogic/meson-g12b-khadas-vim3.dtsi   | 32 +++++++++++---
 arch/arm64/boot/dts/amlogic/meson-spifc-g12.dtsi   | 49 ++++++++++++++++++++++
 arch/arm64/boot/dts/amlogic/meson-spifc-gxl.dtsi   | 34 +++++++++++++++
 4 files changed, 126 insertions(+), 25 deletions(-)
 create mode 100644 arch/arm64/boot/dts/amlogic/meson-spifc-g12.dtsi
 create mode 100644 arch/arm64/boot/dts/amlogic/meson-spifc-gxl.dtsi

diff --git a/arch/arm64/boot/dts/amlogic/meson-g12-common.dtsi b/arch/arm64/boot/dts/amlogic/meson-g12-common.dtsi
index c4f174b..dcb4452 100644
--- a/arch/arm64/boot/dts/amlogic/meson-g12-common.dtsi
+++ b/arch/arm64/boot/dts/amlogic/meson-g12-common.dtsi
@@ -1451,7 +1451,6 @@
 				ranges = <0x0 0x0 0x0 0x42000 0x0 0x2000>;
 
 				clkc_audio: clock-controller@0 {
-					status = "disabled";
 					compatible = "amlogic,g12a-audio-clkc";
 					reg = <0x0 0x0 0x0 0xb4>;
 					#clock-cells = <1>;
@@ -1487,7 +1486,7 @@
 					interrupts = <GIC_SPI 148 IRQ_TYPE_EDGE_RISING>;
 					clocks = <&clkc_audio AUD_CLKID_TODDR_A>;
 					resets = <&arb AXG_ARB_TODDR_A>;
-					status = "disabled";
+					status = "okay";
 				};
 
 				toddr_b: audio-controller@140 {
@@ -1499,7 +1498,7 @@
 					interrupts = <GIC_SPI 149 IRQ_TYPE_EDGE_RISING>;
 					clocks = <&clkc_audio AUD_CLKID_TODDR_B>;
 					resets = <&arb AXG_ARB_TODDR_B>;
-					status = "disabled";
+					status = "okay";
 				};
 
 				toddr_c: audio-controller@180 {
@@ -1511,7 +1510,7 @@
 					interrupts = <GIC_SPI 150 IRQ_TYPE_EDGE_RISING>;
 					clocks = <&clkc_audio AUD_CLKID_TODDR_C>;
 					resets = <&arb AXG_ARB_TODDR_C>;
-					status = "disabled";
+					status = "okay";
 				};
 
 				frddr_a: audio-controller@1c0 {
@@ -1523,7 +1522,7 @@
 					interrupts = <GIC_SPI 152 IRQ_TYPE_EDGE_RISING>;
 					clocks = <&clkc_audio AUD_CLKID_FRDDR_A>;
 					resets = <&arb AXG_ARB_FRDDR_A>;
-					status = "disabled";
+					status = "okay";
 				};
 
 				frddr_b: audio-controller@200 {
@@ -1535,7 +1534,7 @@
 					interrupts = <GIC_SPI 153 IRQ_TYPE_EDGE_RISING>;
 					clocks = <&clkc_audio AUD_CLKID_FRDDR_B>;
 					resets = <&arb AXG_ARB_FRDDR_B>;
-					status = "disabled";
+					status = "okay";
 				};
 
 				frddr_c: audio-controller@240 {
@@ -1547,11 +1546,11 @@
 					interrupts = <GIC_SPI 154 IRQ_TYPE_EDGE_RISING>;
 					clocks = <&clkc_audio AUD_CLKID_FRDDR_C>;
 					resets = <&arb AXG_ARB_FRDDR_C>;
-					status = "disabled";
+					status = "okay";
 				};
 
 				arb: reset-controller@280 {
-					status = "disabled";
+					status = "okay";
 					compatible = "amlogic,meson-axg-audio-arb";
 					reg = <0x0 0x280 0x0 0x4>;
 					#reset-cells = <1>;
@@ -1570,7 +1569,7 @@
 						 <&clkc_audio AUD_CLKID_TDMIN_A_LRCLK>;
 					clock-names = "pclk", "sclk", "sclk_sel",
 						      "lrclk", "lrclk_sel";
-					status = "disabled";
+					status = "okay";
 				};
 
 				tdmin_b: audio-controller@340 {
@@ -1585,7 +1584,6 @@
 						 <&clkc_audio AUD_CLKID_TDMIN_B_LRCLK>;
 					clock-names = "pclk", "sclk", "sclk_sel",
 						      "lrclk", "lrclk_sel";
-					status = "disabled";
 				};
 
 				tdmin_c: audio-controller@380 {
@@ -1600,7 +1598,7 @@
 						 <&clkc_audio AUD_CLKID_TDMIN_C_LRCLK>;
 					clock-names = "pclk", "sclk", "sclk_sel",
 						      "lrclk", "lrclk_sel";
-					status = "disabled";
+					status = "okay";
 				};
 
 				tdmin_lb: audio-controller@3c0 {
@@ -1615,7 +1613,7 @@
 						 <&clkc_audio AUD_CLKID_TDMIN_LB_LRCLK>;
 					clock-names = "pclk", "sclk", "sclk_sel",
 						      "lrclk", "lrclk_sel";
-					status = "disabled";
+					status = "okay";
 				};
 
 				spdifin: audio-controller@400 {
@@ -1628,7 +1626,7 @@
 					clocks = <&clkc_audio AUD_CLKID_SPDIFIN>,
 						 <&clkc_audio AUD_CLKID_SPDIFIN_CLK>;
 					clock-names = "pclk", "refclk";
-					status = "disabled";
+					status = "okay";
 				};
 
 				spdifout: audio-controller@480 {
@@ -1640,7 +1638,7 @@
 					clocks = <&clkc_audio AUD_CLKID_SPDIFOUT>,
 						 <&clkc_audio AUD_CLKID_SPDIFOUT_CLK>;
 					clock-names = "pclk", "mclk";
-					status = "disabled";
+					status = "okay";
 				};
 
 				tdmout_a: audio-controller@500 {
@@ -1654,7 +1652,7 @@
 						 <&clkc_audio AUD_CLKID_TDMOUT_A_LRCLK>;
 					clock-names = "pclk", "sclk", "sclk_sel",
 						      "lrclk", "lrclk_sel";
-					status = "disabled";
+					status = "okay";
 				};
 
 				tdmout_b: audio-controller@540 {
@@ -1668,7 +1666,7 @@
 						 <&clkc_audio AUD_CLKID_TDMOUT_B_LRCLK>;
 					clock-names = "pclk", "sclk", "sclk_sel",
 						      "lrclk", "lrclk_sel";
-					status = "disabled";
+					status = "okay";
 				};
 
 				tdmout_c: audio-controller@580 {
@@ -1682,7 +1680,7 @@
 						 <&clkc_audio AUD_CLKID_TDMOUT_C_LRCLK>;
 					clock-names = "pclk", "sclk", "sclk_sel",
 						      "lrclk", "lrclk_sel";
-					status = "disabled";
+					status = "okay";
 				};
 
 				spdifout_b: audio-controller@680 {
@@ -1694,7 +1692,7 @@
 					clocks = <&clkc_audio AUD_CLKID_SPDIFOUT_B>,
 						 <&clkc_audio AUD_CLKID_SPDIFOUT_B_CLK>;
 					clock-names = "pclk", "mclk";
-					status = "disabled";
+					status = "okay";
 				};
 
 				tohdmitx: audio-controller@744 {
@@ -1702,7 +1700,7 @@
 					reg = <0x0 0x744 0x0 0x4>;
 					#sound-dai-cells = <1>;
 					sound-name-prefix = "TOHDMITX";
-					status = "disabled";
+					status = "okay";
 				};
 			};
 
diff --git a/arch/arm64/boot/dts/amlogic/meson-g12b-khadas-vim3.dtsi b/arch/arm64/boot/dts/amlogic/meson-g12b-khadas-vim3.dtsi
index 25b1df5..8512cc5 100644
--- a/arch/arm64/boot/dts/amlogic/meson-g12b-khadas-vim3.dtsi
+++ b/arch/arm64/boot/dts/amlogic/meson-g12b-khadas-vim3.dtsi
@@ -90,17 +90,17 @@
 		};
 	};
 
-	leds {
+	leds: leds {
 		compatible = "gpio-leds";
 
-		white {
+		led_white: white {
 			label = "vim3:white";
-			gpios = <&gpio_ao GPIOAO_4 GPIO_ACTIVE_LOW>;
+			gpios = <&gpio_ao GPIOAO_4 GPIO_ACTIVE_HIGH>;
 		};
 
-		red {
+		led_red: red {
 			label = "vim3:red";
-			gpios = <&gpio_expander 5 GPIO_ACTIVE_LOW>;
+			gpios = <&gpio_expander 5 GPIO_ACTIVE_HIGH>;
 		};
 	};
 
@@ -430,7 +430,7 @@
 &i2c_AO {
 	status = "okay";
 	pinctrl-0 = <&i2c_ao_sck_pins>, <&i2c_ao_sda_pins>;
-	pinctrl-names = "default";
+	clock-frequency = <100000>; /* default 100k */
 
 	sensor@e {
 		compatible = "kionix,kxtj21009";
@@ -621,3 +621,23 @@
 	status = "okay";
 	dr_mode = "peripheral";
 };
+
+/////
+
+&led_red{
+    default-state = "off";
+};
+
+&led_white{
+    default-state = "on";
+    linux,default-trigger = "heartbeat";
+};
+
+&i2c3{
+	pinctrl-0 = <&i2c3_sck_a_pins>, <&i2c3_sda_a_pins>;
+	clock-frequency = <100000>; /* default 100k */
+	pinctrl-names = "default";
+	status = "okay";
+};
+
+#include "meson-spifc-g12.dtsi"
diff --git a/arch/arm64/boot/dts/amlogic/meson-spifc-g12.dtsi b/arch/arm64/boot/dts/amlogic/meson-spifc-g12.dtsi
new file mode 100644
index 0000000..c7d8c07
--- /dev/null
+++ b/arch/arm64/boot/dts/amlogic/meson-spifc-g12.dtsi
@@ -0,0 +1,49 @@
+
+&periphs_pinctrl {
+			nor_pins: nor {
+			mux {
+			    groups = "nor_d",
+			    "nor_q",
+			    "nor_c",
+			    "nor_cs";
+			    function = "nor";
+			    bias-disable;
+			};
+		    };
+};
+
+
+&cbus {
+    spifc: spi@14000 {
+    compatible = "amlogic,meson-gxbb-spifc";
+    reg = <0x0 0x14000 0x0 0x80>;
+    #address-cells = <1>;
+    #size-cells = <0>;
+//  clocks = <&clkc CLKID_SPI>;
+    clocks = <&clkc CLKID_SD_EMMC_B>;
+    status = "disabled";
+    };
+};
+
+
+&spifc {
+//  status = "okay";
+    status = "disabled";
+    pinctrl-0 = <&nor_pins>;
+    pinctrl-names = "default";
+
+    w25q128fw: spi-flash@0 {
+    #address-cells = <1>;
+    #size-cells = <1>;
+    compatible = "winbond,w25q128fw", "jedec,spi-nor";
+    reg = <0>;
+    spi-max-frequency = <104000000>;
+    };
+};
+
+/ {
+    aliases {
+	spifc = &spifc;
+    };
+};
+
diff --git a/arch/arm64/boot/dts/amlogic/meson-spifc-gxl.dtsi b/arch/arm64/boot/dts/amlogic/meson-spifc-gxl.dtsi
new file mode 100644
index 0000000..8c7121b
--- /dev/null
+++ b/arch/arm64/boot/dts/amlogic/meson-spifc-gxl.dtsi
@@ -0,0 +1,34 @@
+
+&cbus {
+    spifc: spi@8c80 {
+	compatible = "amlogic,meson-gx-spifc", "amlogic,meson-gxbb-spifc";
+	reg = <0x0 0x08c80 0x0 0x80>;
+	#address-cells = <1>;
+	#size-cells = <0>;
+	clocks = <&clkc CLKID_SPI>;
+	status = "disabled";
+    };
+};
+
+
+&spifc {
+//  status = "okay";
+    status = "disabled";
+    pinctrl-0 = <&nor_pins>;
+    pinctrl-names = "default";
+
+    w25q128fw: spi-flash@0 {
+    #address-cells = <1>;
+    #size-cells = <1>;
+    compatible = "winbond,w25q128fw", "jedec,spi-nor";
+    reg = <0>;
+    spi-max-frequency = <104000000>;
+    };
+};
+
+/ {
+    aliases {
+    spifc = &spifc;
+    };
+};
+
-- 
2.14.1

